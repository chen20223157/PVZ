# 🎮 植物大战僵尸 v4.0 - 章节系统

> **从10关线性游戏 → 30+关多章节冒险！**

---

## 🚀 立即体验

### 方法1：测试页面（强烈推荐）⭐⭐⭐

```bash
# 打开测试页面
打开 test-chapter.html

# 功能：
✓ 查看所有章节和关卡
✓ 测试章节切换
✓ 模拟完成关卡
✓ 查看进度和解锁
✓ 实时金币和星星统计
```

### 方法2：查看设计文档

```bash
# 完整设计文档
打开 v4.0章节系统设计.md

# 快速指南
打开 v4.0快速指南.md
```

---

## 📊 v4.0 vs v3.0

| 特性 | v3.0 | v4.0 | 提升幅度 |
|------|------|------|---------|
| **章节数** | 1个 | 5个 | 🔥 +400% |
| **关卡数** | 10关 | 30+关 | 🔥 +200% |
| **植物种类** | 5种 | 24+种 | 🔥 +380% |
| **游戏时长** | 30分钟 | 3小时+ | 🔥 +600% |
| **金币系统** | ❌ | ✅ | 🆕 新增 |
| **星级评价** | ❌ | ✅ | 🆕 新增 |
| **主题场景** | 1个（白天） | 5个 | 🆕 多样化 |
| **重玩价值** | 低 | 高 | 🔥 显著提升 |

---

## 🗺️ 5大章节概览

### 🌞 第1章：草坪保卫战
```
关卡：10关（1-1 ~ 1-10）
难度：★☆☆☆☆ 教学 + 基础
主题：白天草坪，基础教学
特色：逐步解锁基础植物
金币：13,250
植物：9种（豌豆射手、向日葵、坚果墙...）
```

### 🌙 第2章：夜幕降临
```
关卡：5关（2-1 ~ 2-5）
难度：★★☆☆☆ 简单 + 中等
主题：夜间挑战，阳光稀缺
特色：蘑菇类植物登场
金币：8,400
植物：5种（小太阳、小喷菇、毁灭菇...）
```

### 🏊 第3章：泳池保卫战
```
关卡：4关（3-1 ~ 3-4）
难度：★★★☆☆ 中等 + 困难
主题：水池战斗，地形变化
特色：水陆两栖作战
金币：10,000
植物：4种（莲叶、海蘑菇、冰西瓜...）
```

### 🏠 第4章：屋顶危机
```
关卡：4关（4-1 ~ 4-4）
难度：★★★★☆ 困难 + Boss
主题：斜屋顶，抛物线攻击
特色：高级战术，空中威胁
金币：14,800
植物：4种（三线射手、南瓜、叶子保护伞...）
```

### 🎖️ 第5章：最终挑战
```
关卡：1关（5-1）
难度：★★★★★★ 终极Boss
主题：全植物终极之战
特色：100只僵尸，极限挑战
金币：10,000
植物：1种（模仿者 - 全能植物）
```

---

## 🌱 植物解锁系统

### 完整植物列表（24种）

#### 第1章解锁（9种）
1. 💚 豌豆射手 - 基础输出
2. 🌻 向日葵 - 阳光制造
3. 🪨 坚果墙 - 第一防线
4. 🧨 土豆地雷 - 陷阱杀手
5. ❄️ 寒冰射手 - 减速输出
6. 💥 樱桃炸弹 - 群伤核弹
7. 😈 大嘴花 - 近战吞噬
8. 🔫 双发射手 - 双倍火力
9. 🌶️ 火爆辣椒 - 单行秒杀

#### 第2章解锁（5种）
10. ☀️ 小太阳 - 夜间阳光
11. 🍄 小喷菇 - 廉价输出
12. 🍄 毁灭菇 - 范围核弹
13. ☕ 咖啡豆 - 唤醒蘑菇
14. 🌵 地刺 - 地面陷阱

#### 第3章解锁（4种）
15. 🍃 莲叶 - 水上平台
16. 💧 海蘑菇 - 水下输出
17. 🌊 冰西瓜 - 水上冰冻
18. 🌊 缠绕海草 - 水下吞噬

#### 第4章解锁（4种）
19. 📈 三线射手 - 斜面输出
20. 🎃 南瓜护甲 - 屋顶保护
21. ☔ 叶子保护伞 - 防气球
22. 🧲 磁力菇 - 拆金属

#### 第5章解锁（1种）
23. 👥 模仿者 - 全能输出

#### 未来扩展（+N种）
24. 🌻🌻 双子向日葵
25. 🔥 火炬树桩
26. 🌽 玉米投手
27. 🥬 卷心菜投手
... 等等

---

## 💰 金币系统

### 金币获取

**完成关卡：**
```
第1章：800-2500金币/关（总计13,250）
第2章：1200-2000金币/关（总计8,400）
第3章：1800-2500金币/关（总计10,000）
第4章：2500-3500金币/关（总计14,800）
第5章：5000金币（Boss战）

全部通关：56,450+ 金币
```

**额外奖励：**
```
Boss关额外奖励：500-5000金币
完美通关：+50%金币
无损通关：+30%金币
速通奖励：+20%金币
连击奖励：每5连击 +100金币
```

### 金币用途（未来）

```
植物升级：
  初级升级（500金币）：+20% 属性
  中级升级（1000金币）：+40% 属性
  高级升级（2000金币）：+60% 属性 + 特效

购买道具：
  阳光雨（100金币）：全场 +200阳光
  时间暂停（150金币）：暂停5秒
  清场炸弹（200金币）：清除所有僵尸

解锁内容：
  无尽模式（5000金币）
  小游戏模式（3000金币）
  禅意花园（2000金币）
```

---

## ⭐ 星级评价系统

### 评分标准

```
⭐ 1星：完成关卡
  - 消灭所有僵尸
  
⭐⭐ 2星：无损通关
  - 消灭所有僵尸
  - 所有植物存活
  - 小推车未使用
  
⭐⭐⭐ 3星：完美通关
  - 消灭所有僵尸
  - 所有植物存活
  - 小推车未使用
  - 时间 < 标准时间
```

### 星星奖励

```
累计奖励：
  10星：解锁小游戏模式
  30星：解锁无尽模式
  50星：解锁禅意花园
  90星：解锁全图鉴
  满星：解锁隐藏植物 + 全成就
```

---

## 📁 核心文件

### ✅ 已创建

```javascript
ChapterSystem.js          // 章节系统核心（630行）
ChapterSelect.js          // 章节选择界面（430行）
test-chapter.html         // 测试页面
v4.0章节系统设计.md        // 完整设计文档
v4.0快速指南.md           // 快速上手指南
README-v4.0.md           // 本文档
```

### 🔨 待集成

```javascript
Game.js                   // 需要集成章节系统
config.js                 // 需要添加新植物配置
Plant.js                  // 需要实现新植物类型
```

### 📋 待创建

```javascript
CoinSystem.js            // 金币系统详细逻辑
StarSystem.js            // 星级评价系统
PlantUpgrade.js          // 植物升级系统
ShopSystem.js            // 商店系统
```

---

## 🎯 快速开始

### 步骤1：测试系统（1分钟）

```bash
1. 打开 test-chapter.html
2. 点击章节标签切换章节
3. 点击关卡卡片选择关卡
4. 点击"模拟完成当前关卡"测试解锁
5. 查看金币和星星变化
```

### 步骤2：查看代码（5分钟）

```bash
1. 打开 ChapterSystem.js
   - 查看章节和关卡数据结构
   - 查看解锁逻辑
   - 查看进度保存

2. 打开 ChapterSelect.js
   - 查看界面绘制逻辑
   - 查看点击处理
   - 查看滚动功能
```

### 步骤3：集成到游戏（30分钟）

```bash
1. 在 Game.js 中替换 levelSystem 为 chapterSystem
2. 替换 LevelSelect 为 ChapterSelect
3. 更新 startLevel 和 win 方法
4. 测试基础流程
```

---

## 💻 代码示例

### 使用章节系统

```javascript
import { chapterSystem } from './ChapterSystem.js';

// 获取章节
const chapter1 = chapterSystem.getChapter(1);
console.log(chapter1.name);  // "第1章 草坪保卫战"

// 获取关卡
const level = chapterSystem.getLevel('1-1');
console.log(level.name);     // "1-1 初次相遇"

// 完成关卡
chapterSystem.completeLevel('1-1', 3, 800);

// 查看进度
console.log(chapterSystem.progress);
// {
//   currentChapter: 1,
//   unlockedChapters: [1],
//   completedLevels: ['1-1'],
//   unlockedPlants: ['peashooter'],
//   totalCoins: 800,
//   totalStars: 3
// }

// 检查解锁
chapterSystem.isChapterUnlocked(2);  // false
chapterSystem.isLevelCompleted('1-1');  // true
chapterSystem.isPlantUnlocked('peashooter');  // true
```

### 使用章节选择界面

```javascript
import { ChapterSelect } from './ChapterSelect.js';

// 创建界面
const chapterSelect = new ChapterSelect(
  canvas,
  (levelId) => {
    console.log('开始关卡:', levelId);
    startLevel(levelId);
  }
);

// 显示界面
chapterSelect.show();

// 绘制界面
chapterSelect.draw(ctx);

// 处理点击
canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  chapterSelect.handleClick(x, y);
});

// 处理滚轮
canvas.addEventListener('wheel', (e) => {
  e.preventDefault();
  chapterSelect.handleWheel(e.deltaY);
});
```

---

## 🎨 界面预览

### 章节选择界面

```
┌────────────────────────────────────────────────┐
│            🎮 关卡选择                [×]      │
├────────────────────────────────────────────────┤
│ [🌞第1章] [🌙第2章] [🏊第3章] [🏠第4章] [🎖️第5章] │
├────────────────────────────────────────────────┤
│ 🌞 第1章 草坪保卫战                            │
├────────────────────────────────────────────────┤
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐     │
│ │1-1  │ │1-2  │ │1-3  │ │1-4  │ │1-5  │     │
│ │教学 │ │简单 │ │简单 │ │简单 │ │中等 │     │
│ │🧟8只│ │🧟12 │ │🧟15 │ │🧟18 │ │🧟20 │     │
│ │💰800│ │💰800│ │💰900│ │💰950│ │💰1000│    │
│ │💚豌豆│ │🌻向日│ │🪨坚果│ │🧨地雷│ │❄️寒冰│     │
│ │  ✓  │ │  ✓  │ │     │ │  🔒 │ │  🔒 │     │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘     │
│                                                │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐     │
│ │ ... │ │ ... │ │ ... │ │ ... │ │1-10 │     │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘     │
├────────────────────────────────────────────────┤
│ 💰金币:13250  ⭐星星:24  📊进度:8/10 (80%)    │
└────────────────────────────────────────────────┘
```

---

## 🚧 开发路线图

### ✅ 阶段1：框架完成（当前）
- [x] 章节系统核心逻辑
- [x] 章节选择界面
- [x] 测试页面
- [x] 设计文档

### 🔨 阶段2：游戏集成（进行中）
- [ ] 集成到 Game.js
- [ ] 替换旧的关卡系统
- [ ] 测试基础流程
- [ ] 修复集成问题

### 📋 阶段3：新植物实现
- [ ] 土豆地雷
- [ ] 火爆辣椒
- [ ] 大嘴花
- [ ] 双发射手
- [ ] 其他新植物...

### 📋 阶段4：系统扩展
- [ ] 金币系统完善
- [ ] 星级评价系统
- [ ] 植物升级系统
- [ ] 商店系统

### 📋 阶段5：高级功能
- [ ] 无尽模式
- [ ] 小游戏模式
- [ ] 禅意花园
- [ ] 图鉴系统
- [ ] 成就系统

---

## 📞 常见问题

### Q: 如何测试章节系统？
A: 打开 `test-chapter.html`，这是一个完整的测试页面。

### Q: 如何集成到主游戏？
A: 参考 `v4.0快速指南.md` 中的"集成到主游戏"章节。

### Q: 新植物如何实现？
A: 先在 `config.js` 中添加配置，然后在 `Plant.js` 中实现逻辑。

### Q: 金币系统什么时候实现？
A: 核心金币功能已在 `ChapterSystem.js` 中实现，完整商店系统将在阶段4实现。

### Q: 如何重置进度？
A: 在测试页面点击"重置进度"按钮，或在浏览器控制台运行 `chapterSystem.resetProgress()`。

---

## 🎉 总结

### v4.0 是什么？

v4.0 是对游戏的**重大升级**，将游戏从：
- ✅ 单一章节 → 5大主题章节
- ✅ 10个关卡 → 30+个关卡
- ✅ 5种植物 → 24+种植物
- ✅ 30分钟游戏 → 3小时+长期游戏
- ✅ 无收集要素 → 金币、星星、升级系统

### v4.0 带来了什么？

- 🎮 **更长的游戏时间**
- 🌱 **更多的植物收集**
- 💰 **金币和升级系统**
- ⭐ **星级评价挑战**
- 🏆 **更高的重玩价值**
- 📈 **渐进式难度设计**

### 下一步？

1. 📝 查看 `v4.0快速指南.md`
2. 🎮 打开 `test-chapter.html` 测试
3. 💻 开始集成到主游戏
4. 🚀 实现更多新功能

---

**让我们一起打造最好的植物大战僵尸游戏！** 🌻🧟‍♂️🎮

---

**版本：** v4.0  
**状态：** 框架完成，待集成  
**更新日期：** 2024  
**作者：** Claude + 您的团队
