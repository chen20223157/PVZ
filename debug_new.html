<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤ç‰©å¤§æˆ˜åƒµå°¸ - è°ƒè¯•ç‰ˆæœ¬ v2</title>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: #fff; font-family: Arial, sans-serif; }
        #console {
            background: #000;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            margin: 10px 0;
            border-radius: 5px;
        }
        #console div {
            margin: 2px 0;
            padding: 2px;
        }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .info { color: #74c0fc; }
        button {
            padding: 10px 20px;
            margin: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        canvas {
            border: 2px solid #fff;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            background: #333;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ± æ¤ç‰©å¤§æˆ˜åƒµå°¸ - è°ƒè¯•ç‰ˆæœ¬</h1>
    <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
    <button id="resetBtn">é‡ç½®æ¸¸æˆ</button>

    <div class="status" id="status">çŠ¶æ€ï¼šç­‰å¾…å¼€å§‹</div>

    <div id="console">
        <div>[ç³»ç»Ÿ] è°ƒè¯•æ§åˆ¶å°å·²å‡†å¤‡</div>
    </div>

    <canvas id="gameCanvas" width="900" height="600"></canvas>

    <script type="module">
        const consoleEl = document.getElementById('console');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusEl = document.getElementById('status');

        // è‡ªå®šä¹‰æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${timestamp}] ${message}`;
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight;
            console.log(message);
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(status) {
            statusEl.textContent = `çŠ¶æ€ï¼š${status}`;
        }

        let game = null;
        let initialized = false;

        startBtn.addEventListener('click', async function() {
            if (game) {
                log('æ¸¸æˆå·²ç»åœ¨è¿è¡Œï¼', 'info');
                updateStatus('æ¸¸æˆä¸­');
                return;
            }

            startBtn.disabled = true;
            log('å¼€å§‹åˆå§‹åŒ–æ¸¸æˆ...', 'info');
            updateStatus('æ­£åœ¨åŠ è½½...');

            try {
                // åŠ¨æ€å¯¼å…¥æ¸¸æˆæ¨¡å—
                log('æ­£åœ¨å¯¼å…¥ Game æ¨¡å—...', 'info');
                const { Game } = await import('./Game.js');
                log('âœ“ Game æ¨¡å—å¯¼å…¥æˆåŠŸ', 'success');

                // åˆ›å»ºç”»å¸ƒ
                const canvas = document.getElementById('gameCanvas');
                log('âœ“ ç”»å¸ƒå‡†å¤‡å°±ç»ª', 'success');

                // åˆ›å»ºæ¸¸æˆå®ä¾‹
                game = new Game(canvas);
                log('âœ“ æ¸¸æˆå®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                log(`åˆå§‹çŠ¶æ€: ${game.state}`, 'info');

                // å¯åŠ¨æ¸¸æˆå¾ªç¯
                game.start();
                log('âœ“ æ¸¸æˆå¾ªç¯å·²å¯åŠ¨', 'success');

                updateStatus('æ¸¸æˆè¿è¡Œä¸­');
                initialized = true;

            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`, 'error');
                log(`å †æ ˆ: ${error.stack}`, 'error');
                updateStatus('åˆå§‹åŒ–å¤±è´¥');

                startBtn.disabled = false;
            }
        });

        resetBtn.addEventListener('click', function() {
            if (game) {
                log('æ­£åœ¨é‡ç½®æ¸¸æˆ...', 'info');
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ¸…ç†é€»è¾‘
                game = null;
            }

            // æ¸…ç©ºæ§åˆ¶å°
            consoleEl.innerHTML = '<div>[ç³»ç»Ÿ] æ§åˆ¶å°å·²æ¸…ç©º</div>';

            startBtn.disabled = false;
            updateStatus('ç­‰å¾…å¼€å§‹');
            initialized = false;

            log('æ¸¸æˆå·²é‡ç½®', 'info');
        });

        // æ£€æŸ¥æ¨¡å—å¯¼å…¥
        try {
            const moduleCheck = await import('./config.js');
            log('âœ“ é…ç½®æ¨¡å—æ­£å¸¸', 'success');
        } catch (error) {
            log('âŒ é…ç½®æ¨¡å—å¯¼å…¥å¤±è´¥', 'error');
        }
    </script>
</body>
</html>