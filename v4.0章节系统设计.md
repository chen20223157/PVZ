
# 🎮 v4.0 章节系统完整设计

## 📋 版本信息
- **版本号：** v4.0  
- **更新日期：** 2024  
- **更新类型：** 重大功能升级 - 多章节系统  
- **状态：** 🚧 设计阶段（框架已创建）

---

## ✨ 核心更新

### 1. 🗺️ 多章节系统
从原来的10关线性关卡 → **5大章节，30+关卡**

```
🌞 第1章：草坪保卫战 (10关) - 白天教学
🌙 第2章：夜幕降临 (5关) - 夜间挑战  
🏊 第3章：泳池保卫战 (4关) - 水上战斗
🏠 第4章：屋顶危机 (4关) - 斜坡难题
🎖️ 第5章：最终挑战 (1关) - 终极Boss
```

### 2. 🌱 植物解锁系统扩展
原来5种植物 → **30+种植物**

**第1章解锁（10种）：**
- 1-1: 豌豆射手 💚
- 1-2: 向日葵 🌻
- 1-3: 坚果墙 🪨
- 1-4: 土豆地雷 🧨
- 1-5: 寒冰射手 ❄️
- 1-6: 樱桃炸弹 💥
- 1-7: 大嘴花 😈
- 1-8: 双发射手 🔫
- 1-9: 火爆辣椒 🌶️

**第2章解锁（5种）：**
- 2-1: 小太阳 ☀️
- 2-2: 小喷菇 🍄
- 2-3: 毁灭菇 🍄
- 2-4: 咖啡豆 ☕
- 2-5: 地刺 🌵

**第3章解锁（4种）：**
- 3-1: 莲叶 🍃
- 3-2: 海蘑菇 💧
- 3-3: 冰西瓜 🌊
- 3-4: 缠绕海草 🌊

**第4章解锁（4种）：**
- 4-1: 三线射手 📈
- 4-2: 南瓜护甲 🎃
- 4-3: 叶子保护伞 ☔
- 4-4: 磁力菇 🧲

**第5章解锁（1种）：**
- 5-1: 模仿者 👥

### 3. 💰 金币系统
**金币用途：**
- 购买高级植物
- 升级现有植物
- 解锁特殊功能
- 购买道具

**金币获取：**
- 完成关卡奖励
- Boss关额外奖励
- 完美通关额外奖励
- 连击奖励

**金币奖励表：**
```
第1章：800-2500金币/关
第2章：1200-2000金币/关
第3章：1800-2500金币/关
第4章：2500-3500金币/关（Boss +3000）
第5章：5000金币（Boss +5000）

总计可获得：约50,000金币
```

### 4. ⭐ 星级评价系统
**评价标准：**
- ⭐ 1星：完成关卡
- ⭐⭐ 2星：无植物损失
- ⭐⭐⭐ 3星：完美通关（无植物损失 + 时间奖励）

**星星用途：**
- 解锁隐藏关卡
- 购买稀有植物
- 解锁成就

---

## 📊 章节详细设计

### 🌞 第1章：草坪保卫战（白天）

**主题：** 新手教学  
**难度：** ⭐ - ⭐⭐⭐  
**特点：** 逐步解锁基础植物，学习核心玩法  

#### 关卡列表

| 关卡 | 名称 | 僵尸数 | 难度 | 解锁植物 | 金币 |
|------|------|--------|------|----------|------|
| 1-1 | 初次相遇 | 8 | 教学 | 豌豆射手💚 | 800 |
| 1-2 | 阳光工厂 | 12 | 简单 | 向日葵🌻 | 800 |
| 1-3 | 第一道防线 | 15 | 简单 | 坚果墙🪨 | 900 |
| 1-4 | 地下陷阱 | 18 | 简单 | 土豆地雷🧨 | 950 |
| 1-5 | 冰冻战术 | 20 | 中等 | 寒冰射手❄️ | 1000 |
| 1-6 | 核弹时刻 | 25 | 中等 | 樱桃炸弹💥 | 1200 |
| 1-7 | 吞噬者 | 28 | 中等 | 大嘴花😈 | 1300 |
| 1-8 | 双倍火力 | 30 | 困难 | 双发射手🔫 | 1500 |
| 1-9 | 终极清场 | 35 | 困难 | 火爆辣椒🌶️ | 1800 |
| 1-10 | 章节Boss | 40 | Boss | - | 2500(+500) |

**总金币：** 13,250  
**解锁植物：** 9种

---

### 🌙 第2章：夜幕降临（夜晚）

**主题：** 资源管理  
**难度：** ⭐⭐ - ⭐⭐⭐  
**特点：** 阳光稀缺，蘑菇类植物登场  

#### 关卡列表

| 关卡 | 名称 | 僵尸数 | 难度 | 解锁植物 | 金币 |
|------|------|--------|------|----------|------|
| 2-1 | 黑暗来袭 | 30 | 简单 | 小太阳☀️ | 1200 |
| 2-2 | 蘑菇军团 | 35 | 简单 | 小喷菇🍄 | 1300 |
| 2-3 | 核武蘑菇 | 40 | 中等 | 毁灭菇🍄 | 1500 |
| 2-4 | 咖啡时光 | 45 | 中等 | 咖啡豆☕ | 1600 |
| 2-5 | 地刺陷阱 | 50 | 困难 | 地刺🌵 | 2000(+800) |

**总金币：** 8,400  
**解锁植物：** 5种

---

### 🏊 第3章：泳池保卫战（水池）

**主题：** 地形变化  
**难度：** ⭐⭐⭐ - ⭐⭐⭐⭐  
**特点：** 水陆两栖作战，新的战术布局  

#### 关卡列表

| 关卡 | 名称 | 僵尸数 | 难度 | 解锁植物 | 金币 |
|------|------|--------|------|----------|------|
| 3-1 | 水上平台 | 35 | 中等 | 莲叶🍃 | 1800 |
| 3-2 | 水下射手 | 40 | 中等 | 海蘑菇💧 | 2000 |
| 3-3 | 冰封之海 | 45 | 困难 | 冰西瓜🌊 | 2200 |
| 3-4 | 深海巨口 | 50 | 困难 | 缠绕海草🌊 | 2500(+1500) |

**总金币：** 10,000  
**解锁植物：** 4种

---

### 🏠 第4章：屋顶危机（斜屋顶）

**主题：** 角度杀手  
**难度：** ⭐⭐⭐⭐ - ⭐⭐⭐⭐⭐  
**特点：** 抛物线攻击，空中威胁  

#### 关卡列表

| 关卡 | 名称 | 僵尸数 | 难度 | 解锁植物 | 金币 |
|------|------|--------|------|----------|------|
| 4-1 | 屋顶初战 | 40 | 困难 | 三线射手📈 | 2500 |
| 4-2 | 南瓜保护 | 45 | 困难 | 南瓜护甲🎃 | 2800 |
| 4-3 | 空中威胁 | 50 | 困难 | 叶子保护伞☔ | 3000 |
| 4-4 | 磁力护盾 | 60 | Boss | 磁力菇🧲 | 3500(+3000) |

**总金币：** 14,800  
**解锁植物：** 4种

---

### 🎖️ 第5章：最终挑战

**主题：** 终极之战  
**难度：** ⭐⭐⭐⭐⭐⭐  
**特点：** 所有植物可用，极限挑战  

#### 关卡列表

| 关卡 | 名称 | 僵尸数 | 难度 | 解锁植物 | 金币 |
|------|------|--------|------|----------|------|
| 5-1 | 终极之战 | 100 | 终极 | 模仿者👥 | 5000(+5000) |

**总金币：** 10,000  
**解锁植物：** 1种（全能）

---

## 🎯 难度曲线设计

### 整体难度分布

```
难度
 │                                      ╱ 5-1 (终极)
 │                                   ╱
 │                              ╱─ 4-4 (Boss)
 │                         ╱───
 │                    ╱─── 4-1~4-3
 │               ╱────
 │          ╱─── 3-1~3-4
 │     ╱────
 │ ───────── 2-1~2-5
 │────────── 1-1~1-10
 └───────────────────────────────── 关卡进度
   1章      2章     3章     4章    5章
```

### 各章节特色

#### 第1章：教学+基础
- **学习目标：** 基础操作，植物搭配
- **核心阵容：** 豌豆射手 + 向日葵 + 坚果墙
- **关键技能：** 阳光管理，植物摆放

#### 第2章：资源管理
- **学习目标：** 低阳光运营，夜间适应
- **核心阵容：** 小喷菇 + 小太阳 + 咖啡豆
- **关键技能：** 廉价布局，应急唤醒

#### 第3章：地形适应
- **学习目标：** 水陆作战，多线防守
- **核心阵容：** 莲叶 + 海蘑菇 + 冰西瓜
- **关键技能：** 水上平台，双线布局

#### 第4章：高级战术
- **学习目标：** 抛物线攻击，全面防御
- **核心阵容：** 三线射手 + 南瓜 + 伞草
- **关键技能：** 斜坡射击，空中防御

#### 第5章：终极挑战
- **学习目标：** 全植物运用，极限操作
- **核心阵容：** 全植物可用
- **关键技能：** 综合运用，完美配合

---

## 💰 金币系统详解

### 金币获取方式

#### 1. 关卡奖励（主要来源）
```
第1章：13,250金币
第2章：8,400金币
第3章：10,000金币
第4章：14,800金币
第5章：10,000金币
─────────────────
总计：56,450金币
```

#### 2. 额外奖励
- **完美通关：** +50%金币
- **无损通关：** +30%金币
- **速通奖励：** +20%金币
- **连击奖励：** 每5连击 +100金币

#### 3. Boss关奖励
- 1-10 Boss: +500金币
- 2-5 Boss: +800金币
- 3-4 Boss: +1500金币
- 4-4 Boss: +3000金币
- 5-1 终极Boss: +5000金币

### 金币用途

#### 购买植物升级
```
初级升级（500金币）：
- 攻击力 +20%
- 血量 +20%
- 冷却时间 -10%

中级升级（1000金币）：
- 攻击力 +40%
- 血量 +40%
- 冷却时间 -20%

高级升级（2000金币）：
- 攻击力 +60%
- 血量 +60%
- 冷却时间 -30%
- 解锁特殊效果
```

#### 购买道具
```
临时道具：
- 阳光雨（100金币）：全场 +200阳光
- 时间暂停（150金币）：暂停5秒
- 清场炸弹（200金币）：清除所有僵尸

永久道具：
- 额外植物槽位（1000金币）：+1格
- 初始阳光提升（1500金币）：+50
- 冷却加速（2000金币）：全局 -10%
```

#### 解锁隐藏内容
```
- 无尽模式（5000金币）
- 小游戏模式（3000金币）
- 禅意花园（2000金币）
- 图鉴收集（免费，通过游戏解锁）
```

---

## ⭐ 星级评价系统

### 评分标准

#### ⭐ 1星（基础完成）
- 消灭所有僵尸
- 至少1个植物存活

#### ⭐⭐ 2星（无损通关）
- 消灭所有僵尸
- 所有植物存活
- 小推车未使用

#### ⭐⭐⭐ 3星（完美通关）
- 消灭所有僵尸
- 所有植物存活
- 小推车未使用
- 时间 < 标准时间

### 星星奖励

**星星累计奖励：**
```
10星：解锁小游戏模式
30星：解锁无尽模式
50星：解锁禅意花园
90星：解锁全图鉴
满星：解锁隐藏植物 + 成就
```

---

## 🗂️ 文件结构

### 新增文件

```
ChapterSystem.js        - 章节系统核心逻辑
ChapterSelect.js        - 章节选择界面
CoinSystem.js          - 金币系统（待创建）
StarSystem.js          - 星级系统（待创建）
PlantUpgrade.js        - 植物升级系统（待创建）
ShopSystem.js          - 商店系统（待创建）
```

### 修改文件

```
Game.js                - 集成章节系统
config.js              - 添加新植物配置
Plant.js               - 添加新植物类型
Zombie.js              - 添加新僵尸类型
```

---

## 🚧 当前状态

### ✅ 已完成
- [x] ChapterSystem.js - 章节数据和逻辑
- [x] ChapterSelect.js - 章节选择界面
- [x] 5章节30+关卡设计
- [x] 植物解锁规划
- [x] 金币系统设计
- [x] 星级评价设计

### 🔨 开发中
- [ ] 集成到主游戏（Game.js）
- [ ] 新植物实现
- [ ] 新僵尸实现
- [ ] 金币系统实现
- [ ] 星级系统实现

### 📋 待开发
- [ ] 植物升级系统
- [ ] 商店系统
- [ ] 无尽模式
- [ ] 小游戏模式
- [ ] 禅意花园
- [ ] 图鉴系统
- [ ] 成就系统

---

## 🎮 如何测试（待集成）

### 测试章节系统

```javascript
// 打开浏览器控制台（F12）
import { chapterSystem } from './ChapterSystem.js';

// 查看所有章节
console.log(chapterSystem.chapters);

// 查看当前进度
console.log(chapterSystem.progress);

// 完成一个关卡
chapterSystem.completeLevel('1-1', 3, 100);

// 查看解锁的植物
console.log(chapterSystem.getUnlockedPlants());
```

### 测试章节选择界面

```javascript
// 在Game.js中
import { ChapterSelect } from './ChapterSelect.js';

// 创建界面
this.chapterSelect = new ChapterSelect(
  this.canvas, 
  (levelId) => this.startLevel(levelId)
);

// 显示界面
this.chapterSelect.show();

// 绘制界面
this.chapterSelect.draw(this.ctx);
```

---

## 📝 集成步骤（TODO）

### 第1步：替换关卡系统

```javascript
// Game.js
// 旧代码：
import { levelSystem } from './LevelSystem.js';
import { LevelSelect } from './LevelSelect.js';

// 新代码：
import { chapterSystem } from './ChapterSystem.js';
import { ChapterSelect } from './ChapterSelect.js';
```

### 第2步：更新游戏逻辑

```javascript
// 修改startLevel方法
startLevel(levelId) {
  const levelData = chapterSystem.getLevel(levelId);
  if (!levelData) {
    alert('关卡不存在！');
    return;
  }
  
  // 应用关卡配置
  this.currentLevelData = levelData;
  this.maxZombies = levelData.maxZombies;
  this.sunManager.setSunCount(levelData.startSun);
  
  // 重置游戏
  this.resetGame();
  this.state = GameState.PLAYING;
}
```

### 第3步：更新胜利逻辑

```javascript
// 修改win方法
win() {
  this.state = GameState.WIN;
  
  if (this.currentLevelData) {
    // 完成关卡，获得金币和星级
    const stars = this.calculateStars();
    const coins = this.calculateCoins();
    
    chapterSystem.completeLevel(
      this.currentLevelData.id,
      stars,
      coins
    );
    
    // 显示奖励
    this.showRewards(stars, coins);
  }
}
```

### 第4步：添加新植物

```javascript
// config.js
PLANTS: {
  // ... 现有植物 ...
  
  // 新植物
  POTATOMINE: {
    id: 'potatomine',
    name: '土豆地雷',
    sunCost: 25,
    cooldown: 30000,
    health: 300,
    damage: 1800, // 一击必杀
    // ...
  },
  
  JALAPENO: {
    id: 'jalapeno',
    name: '火爆辣椒',
    sunCost: 125,
    cooldown: 50000,
    health: 300,
    damage: 1800, // 全行伤害
    // ...
  },
  
  // ... 更多新植物 ...
}
```

---

## 🎯 开发优先级

### 第一阶段（核心功能）
1. ✅ 章节系统框架
2. ✅ 章节选择界面
3. 🔨 集成到主游戏
4. 🔨 新植物基础实现
5. 🔨 金币系统基础

### 第二阶段（扩展功能）
6. 星级评价系统
7. 植物升级系统
8. 商店系统
9. 更多植物类型
10. 更多僵尸类型

### 第三阶段（高级功能）
11. 无尽模式
12. 小游戏模式
13. 禅意花园
14. 图鉴系统
15. 成就系统

---

## 🎉 预期效果

### 玩家体验提升
- 🎮 更长的游戏时间（10关 → 30+关）
- 🌱 更多植物可玩（5种 → 30+种）
- 💰 更多收集要素（金币、星星、升级）
- 🏆 更多挑战目标（完美通关、成就）

### 游戏深度提升
- 📈 渐进式难度提升
- 🎯 多样化关卡设计
- 🛠️ 策略深度增加
- 🔄 重玩价值提升

---

## 📞 反馈和建议

如果你有任何建议或发现问题，欢迎反馈！

**当前版本：** v4.0（设计阶段）  
**下一步：** 集成到主游戏，实现核心功能  
**最终目标：** 完整的多章节塔防游戏体验！

---

**让我们一起打造一个更好的植物大战僵尸游戏！** 🌻🧟‍♂️🎮
